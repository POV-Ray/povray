init:
  - cmd:call "tools/windows/get-source-version.bat" "source/base/version.h"

version: $env:POV_SOURCE_GENERATION+av{build}
pull_requests:
  do_not_increment_build_number: true
branches:
  except:
  - coverity_scan

image: Visual Studio 2017

shallow_clone: true

matrix:
  fast_finish: true

environment:
  GUIProj: windows/vs2015/povray.sln
  GUIDefs: POV_RAY_IS_AUTOBUILD=1;POV_RAY_BUILD_ID="av$(APPVEYOR_BUILD_NUMBER)";BUILT_BY="AppVeyor";
  CUIProj: windows/vs2015/console.vcxproj
  CUIDefs: $(GUIDefs)VERSION_BASE="$env:POV_SOURCE_GENERATION";_CONSOLE;
  matrix:
  # Graphic User Interface (GUI) build matrix
  - PovBuildProj: $(GUIProj)
    PovBuildDefs: $(GUIDefs)
    configuration: Release
    platform: x64
    bin_dir: bin64
    artifact_suffix: -Win64
  - PovBuildProj: $(GUIProj)
    PovBuildDefs: $(GUIDefs)
    configuration: Release-SSE2
    platform: Win32
    bin_dir: bin32
    artifact_suffix: -Win32-sse2
  - PovBuildProj: $(GUIProj)
    PovBuildDefs: $(GUIDefs)
    configuration: Release
    platform: Win32
    bin_dir: bin32
    artifact_suffix: -Win32
  # Console User Interface (CUI) build matrix
  - PovBuildProj: $(CUIProj)
    PovBuildDefs: $(CUIDefs)
    configuration: Release
    platform: x64
    bin_dir: bin64
    artifact_suffix: -Win64
  - PovBuildProj: $(CUIProj)
    PovBuildDefs: $(CUIDefs)
    configuration: Release-SSE2
    platform: Win32
    bin_dir: bin32
    artifact_suffix: -Win32-sse2
  - PovBuildProj: $(CUIProj)
    PovBuildDefs: $(CUIDefs)
    configuration: Release
    platform: Win32
    bin_dir: bin32
    artifact_suffix: -Win32

install:
  - ECHO Check PovBuildProj=%PovBuildProj%
  - ECHO Check PovBuildDefs=%PovBuildDefs%

before_build:

build:
  project: $(PovBuildProj)
  parallel: true
  verbosity: minimal

test: off
